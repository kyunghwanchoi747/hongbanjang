# 성남 AI 민심 법정 - 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          AI 민심 법정 시스템 아키텍처                          │
│                     (전국 복제 가능한 모듈형 설계)                              │
└─────────────────────────────────────────────────────────────────────────────┘

                              ┌─────────────────┐
                              │   CITY_CONFIG   │
                              │  (도시 변수)     │
                              │  - 성남시       │
                              │  - 서울시       │
                              │  - 부산시...    │
                              └────────┬────────┘
                                       │
         ┌─────────────────────────────┼─────────────────────────────┐
         │                             │                             │
         ▼                             ▼                             ▼
┌─────────────────┐         ┌─────────────────┐         ┌─────────────────┐
│                 │         │                 │         │                 │
│  Phase 1        │         │  Phase 2        │         │  Phase 3        │
│  THE DOCKET     │────────▶│  TRIAL ENGINE   │────────▶│  THE GRAND HALL │
│  (데이터 수집)   │         │  (AI 법정 공방)  │         │  (시민 인터페이스)│
│                 │         │                 │         │                 │
└────────┬────────┘         └────────┬────────┘         └────────┬────────┘
         │                           │                           │
         ▼                           ▼                           ▼

┌─────────────────────────────────────────────────────────────────────────────┐
│                           Phase 4: THE FACTORY                              │
│                        (인프라 및 데이터베이스)                               │
│                                                                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │
│  │   City      │  │  DataSource │  │    Case     │  │    Vote     │        │
│  │  (도시)     │  │  (데이터소스)│  │   (사건)    │  │   (투표)    │        │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘        │
│                                                                             │
│                         SQLite / PostgreSQL                                 │
└─────────────────────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════════════
                              PHASE 1: THE DOCKET
                              데이터 수집 파이프라인
═══════════════════════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│   [외부 데이터 소스]                                                         │
│                                                                             │
│   ┌──────────────┐    ┌──────────────┐    ┌──────────────┐                 │
│   │  지역 뉴스    │    │  민원 게시판  │    │   SNS 데이터  │                 │
│   │  (분당신문)   │    │  (시청 홈페이지)│   │  (시뮬레이션) │                 │
│   └──────┬───────┘    └──────┬───────┘    └──────┬───────┘                 │
│          │                   │                   │                         │
│          └───────────────────┼───────────────────┘                         │
│                              ▼                                              │
│                    ┌─────────────────┐                                      │
│                    │   DataScraper   │                                      │
│                    │  (cheerio/axios)│                                      │
│                    └────────┬────────┘                                      │
│                             │                                               │
│                             ▼                                               │
│                    ┌─────────────────┐                                      │
│                    │   RawData       │                                      │
│                    │  (원본 데이터)   │                                      │
│                    └────────┬────────┘                                      │
│                             │                                               │
│                             ▼                                               │
│                    ┌─────────────────┐                                      │
│                    │ CaseStructurizer│                                      │
│                    │  (구조화 에이전트)│                                     │
│                    │                 │                                      │
│                    │  ┌───────────┐  │                                      │
│                    │  │ 규칙 기반 │  │  ◀── OpenAI API 없을 때              │
│                    │  └───────────┘  │                                      │
│                    │        or       │                                      │
│                    │  ┌───────────┐  │                                      │
│                    │  │ GPT-4     │  │  ◀── OpenAI API 있을 때              │
│                    │  └───────────┘  │                                      │
│                    └────────┬────────┘                                      │
│                             │                                               │
│                             ▼                                               │
│                    ┌─────────────────┐                                      │
│                    │ StructuredCase  │                                      │
│                    │  - 사건명        │                                      │
│                    │  - 피고          │                                      │
│                    │  - 쟁점          │                                      │
│                    │  - 관련법령      │                                      │
│                    └─────────────────┘                                      │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════════════
                            PHASE 2: TRIAL ENGINE
                              AI 법정 공방 엔진
═══════════════════════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│                           ┌─────────────────┐                               │
│                           │   TrialEngine   │                               │
│                           │   (재판 엔진)    │                               │
│                           └────────┬────────┘                               │
│                                    │                                        │
│           ┌────────────────────────┼────────────────────────┐              │
│           │                        │                        │              │
│           ▼                        ▼                        ▼              │
│   ┌───────────────┐       ┌───────────────┐       ┌───────────────┐        │
│   │               │       │               │       │               │        │
│   │   PROSECUTOR  │◀─────▶│     JUDGE     │◀─────▶│   DEFENDER    │        │
│   │   (검사)      │       │    (판사)      │       │   (변호인)    │        │
│   │               │       │               │       │               │        │
│   │ ┌───────────┐ │       │ ┌───────────┐ │       │ ┌───────────┐ │        │
│   │ │ 시민 분노  │ │       │ │ 중립 진행  │ │       │ │ 현실 방어  │ │        │
│   │ │ 데이터기반 │ │       │ │ 쟁점 정리  │ │       │ │ 예산 한계  │ │        │
│   │ │ 책임 추궁  │ │       │ │ 투표 유도  │ │       │ │ 개선 계획  │ │        │
│   │ └───────────┘ │       │ └───────────┘ │       │ └───────────┘ │        │
│   └───────────────┘       └───────────────┘       └───────────────┘        │
│                                                                             │
│   ═══════════════════════════════════════════════════════════════════════  │
│                              재판 진행 흐름                                  │
│   ═══════════════════════════════════════════════════════════════════════  │
│                                                                             │
│   Round 1:  판사(개정) → 검사(기소) → 변호인(반박) → 판사(정리)              │
│       │                                                                     │
│       ▼                                                                     │
│   Round 2:  검사(재반박) → 변호인(재반박) → 판사(정리)                       │
│       │                                                                     │
│       ▼                                                                     │
│   Round 3:  검사(최종) → 변호인(최종) → 판사(투표 요청)                      │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════════════
                            PHASE 3: THE GRAND HALL
                               시민 인터페이스
═══════════════════════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                        메인 화면 (/)                                 │   │
│   │                                                                     │   │
│   │   ┌──────────────────────────────────────────────────────────────┐  │   │
│   │   │  🏛️ 성남시 AI 민심 법정                    [3건 재판] [315명] │  │   │
│   │   └──────────────────────────────────────────────────────────────┘  │   │
│   │                                                                     │   │
│   │   ┌──────────────────────────────────────────────────────────────┐  │   │
│   │   │           ⚖️ 행정을 심판하라                                  │  │   │
│   │   │     AI 검사와 변호인의 치열한 공방을 지켜보고,                 │  │   │
│   │   │     시민 배심원으로서 당신의 판결을 내리세요.                  │  │   │
│   │   └──────────────────────────────────────────────────────────────┘  │   │
│   │                                                                     │   │
│   │   ┌─────────────────────────────────────────────────────────────┐   │   │
│   │   │ [재판 진행 중] 분당구 정자동 보도블록 파손 방치 사건          │   │   │
│   │   │ 피고: 도로관리과                                             │   │   │
│   │   │ ████████████░░░░░░  유죄 74% vs 무죄 26%                     │   │   │
│   │   └─────────────────────────────────────────────────────────────┘   │   │
│   │                                                                     │   │
│   │   ┌─────────────────────────────────────────────────────────────┐   │   │
│   │   │ [투표 진행 중] 모란시장 주차장 부족 사건                      │   │   │
│   │   │ 피고: 도시교통과                                             │   │   │
│   │   │ █████████░░░░░░░░░  유죄 61% vs 무죄 39%                     │   │   │
│   │   └─────────────────────────────────────────────────────────────┘   │   │
│   │                                                                     │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                     재판 상세 화면 (/trial/[id])                    │   │
│   │                                                                     │   │
│   │   ┌────────────────────────────────┬────────────────────────────┐   │   │
│   │   │                                │                            │   │   │
│   │   │      AI 공방 메시지 영역        │     국민 참여 판결         │   │   │
│   │   │                                │                            │   │   │
│   │   │  ┌─────────────────────────┐   │   유죄 74% ████████░░      │   │   │
│   │   │  │ 👑 판사                  │   │   무죄 26% ███░░░░░░░      │   │   │
│   │   │  │ 재판을 시작하겠습니다... │   │                            │   │   │
│   │   │  └─────────────────────────┘   │   ┌──────────────────────┐ │   │   │
│   │   │                                │   │  👎 유죄 (행정 실패)  │ │   │   │
│   │   │  ┌─────────────────────────┐   │   └──────────────────────┘ │   │   │
│   │   │  │ 👤 검사                  │   │   ┌──────────────────────┐ │   │   │
│   │   │  │ 6개월간 방치...          │   │   │  👍 무죄 (불가피)    │ │   │   │
│   │   │  └─────────────────────────┘   │   └──────────────────────┘ │   │   │
│   │   │                                │                            │   │   │
│   │   │  ┌─────────────────────────┐   │                            │   │   │
│   │   │  │ 🛡️ 변호인               │   │                            │   │   │
│   │   │  │ 예산 30% 삭감...         │   │                            │   │   │
│   │   │  └─────────────────────────┘   │                            │   │   │
│   │   │                                │                            │   │   │
│   │   └────────────────────────────────┴────────────────────────────┘   │   │
│   │                                                                     │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════════════
                              기술 스택
═══════════════════════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│   Frontend                    Backend                     Database          │
│   ─────────                   ───────                     ────────          │
│   • Next.js 14                • Next.js API Routes        • SQLite (개발)   │
│   • React 18                  • Prisma ORM                • PostgreSQL(운영)│
│   • Tailwind CSS              • OpenAI API                                  │
│   • Framer Motion             • Cheerio (스크래핑)                          │
│   • Zustand (상태관리)         • Axios                                      │
│   • Lucide Icons                                                            │
│                                                                             │
│   ─────────────────────────────────────────────────────────────────────────│
│                                                                             │
│   AI 에이전트                  인프라                                        │
│   ──────────                  ─────                                        │
│   • GPT-4 Turbo               • Vercel (권장)                               │
│   • 시뮬레이션 모드 (폴백)      • Docker (선택)                              │
│                               • CITY_CODE 환경변수로 전국 복제               │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════════════
                            디렉토리 구조
═══════════════════════════════════════════════════════════════════════════════

ai-court/
├── src/
│   ├── app/                    # Next.js App Router
│   │   ├── api/                # API 라우트
│   │   │   ├── cases/          # 사건 CRUD
│   │   │   ├── trial/          # 재판 시뮬레이션
│   │   │   └── vote/           # 투표 처리
│   │   ├── trial/[id]/         # 재판 상세 페이지
│   │   ├── layout.tsx          # 레이아웃
│   │   ├── page.tsx            # 메인 페이지
│   │   └── globals.css         # 전역 스타일
│   │
│   ├── agents/                 # AI 에이전트
│   │   ├── engine.ts           # 재판 엔진
│   │   └── prompts.ts          # 에이전트 프롬프트
│   │
│   ├── scrapers/               # 데이터 수집
│   │   ├── scraper.ts          # 스크래퍼
│   │   ├── structurizer.ts     # 구조화 에이전트
│   │   └── sources.ts          # 데이터 소스 정의
│   │
│   ├── lib/                    # 유틸리티
│   │   ├── prisma.ts           # DB 클라이언트
│   │   └── config.ts           # 설정
│   │
│   └── types/                  # 타입 정의
│       └── index.ts
│
├── prisma/
│   └── schema.prisma           # DB 스키마
│
├── prompts/                    # 마스터 프롬프트
│   ├── prosecutor_master.txt
│   ├── defender_master.txt
│   └── judge_master.txt
│
├── public/                     # 정적 파일
├── .env                        # 환경 변수
└── package.json


═══════════════════════════════════════════════════════════════════════════════
                          전국 복제 가이드
═══════════════════════════════════════════════════════════════════════════════

새로운 도시 추가 시:

1. .env 수정
   CITY_NAME=부산시
   CITY_CODE=busan

2. 데이터 소스 추가 (src/scrapers/sources.ts)
   export const BUSAN_SOURCES: ScrapingSource[] = [...]
   CITY_SOURCES['busan'] = BUSAN_SOURCES

3. 배포
   vercel --env CITY_NAME=부산시 --env CITY_CODE=busan

끝. 코드 수정 없이 환경 변수만으로 전국 어디든 복제 가능.
